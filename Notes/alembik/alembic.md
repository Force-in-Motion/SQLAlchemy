**Alembic** ‚Äî —ç—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏—è–º–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –∞–≤—Ç–æ—Ä–æ–º SQLAlchemy –ú–∞–π–∫–ª–æ–º –ë–∞–π–µ—Ä–æ–º. –û–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (—Å—Ö–µ–º—ã) —Å –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –≤ –º–æ–¥–µ–ª—è—Ö SQLAlchemy, —Ç–∞–∫–∏—Ö –∫–∞–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü, —Å—Ç–æ–ª–±—Ü–æ–≤, –∏–Ω–¥–µ–∫—Å–æ–≤ –∏–ª–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π. –í –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Ç–≤–æ–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ `Ecomerce` (FastAPI, SQLAlchemy, PostgreSQL –≤ Docker, –º–æ–¥–µ–ª–∏ `Owners`, `Pets`, `Species`, `ManipulationFacts`), Alembic –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ —Å—Ö–µ–º—ã, –æ—Å–æ–±–µ–Ω–Ω–æ —Å —É—á—ë—Ç–æ–º —Ç–≤–æ–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö, –∏–Ω–¥–µ–∫—Å–∞—Ö, –∫—ç—à–µ, JOIN-–∞—Ö –∏ `relationship`. –Ø –ø–æ–¥—Ä–æ–±–Ω–æ –æ–±—ä—è—Å–Ω—é, —á—Ç–æ —Ç–∞–∫–æ–µ Alembic, –∫–∞–∫ –µ–≥–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å, –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å, –∫–∞–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã –¥–æ—Å—Ç—É–ø–Ω—ã, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª—å –≤–µ—Ä—Å–∏–π, –∏ –≤—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ, —Å–≤—è–∑–∞–Ω–Ω–æ–µ —Å –µ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º –≤ —Ç–≤–æ—ë–º –ø—Ä–æ–µ–∫—Ç–µ.

### –ß—Ç–æ —Ç–∞–∫–æ–µ Alembic?

- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ**: Alembic ‚Äî —ç—Ç–æ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è Python, –∫–æ—Ç–æ—Ä–∞—è —É–ø—Ä–∞–≤–ª—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏—è–º–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –ø–æ–∑–≤–æ–ª—è—è –ø—Ä–∏–º–µ–Ω—è—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ö–µ–º—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–æ–ª–±—Ü–æ–≤) –∏ –æ—Ç–∫–∞—Ç—ã–≤–∞—Ç—å –∏—Ö –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.
- **–ó–∞—á–µ–º –Ω—É–∂–µ–Ω**:
  - **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–æ–¥–µ–ª–µ–π –∏ –±–∞–∑—ã**: –ö–æ–≥–¥–∞ —Ç—ã –¥–æ–±–∞–≤–ª—è–µ—à—å –Ω–æ–≤—ã–π —Å—Ç–æ–ª–±–µ—Ü –≤ –º–æ–¥–µ–ª—å `Pet` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `age`), Alembic —Å–æ–∑–¥–∞—ë—Ç –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —ç—Ç–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞ –≤ —Ç–∞–±–ª–∏—Ü—É `pets` –≤ PostgreSQL.
  - **–ö–æ–Ω—Ç—Ä–æ–ª—å –≤–µ—Ä—Å–∏–π**: –•—Ä–∞–Ω–∏—Ç –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å—Ö–µ–º—ã, –ø–æ–∑–≤–æ–ª—è—è –æ—Ç–∫–∞—Ç–∏—Ç—å –±–∞–∑—É –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é.
  - **–ö–æ–º–∞–Ω–¥–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞**: –£–ø—Ä–æ—â–∞–µ—Ç —Ä–∞–±–æ—Ç—É –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–∞–∑—ã.
  - **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π**: –ú–∏–≥—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö, —á—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö.
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
  - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å SQLAlchemy: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `Base.metadata` –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π —Å —Ç–µ–∫—É—â–µ–π —Å—Ö–µ–º–æ–π –±–∞–∑—ã.
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –°–£–ë–î: PostgreSQL, MySQL, SQLite, Oracle.
  - –ì–∏–±–∫–æ—Å—Ç—å: –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–∏—Å–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—Ä—É—á–Ω—É—é –∏–ª–∏ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
  - –ö–æ–Ω—Ç—Ä–æ–ª—å –≤–µ—Ä—Å–∏–π: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–∏—Å—Ç–µ–º—É, –ø–æ—Ö–æ–∂—É—é –Ω–∞ Git, —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞–º–∏ –º–∏–≥—Ä–∞—Ü–∏–π.

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Alembic

1. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ pip**:
   –£–±–µ–¥–∏—Å—å, —á—Ç–æ —Ç—ã –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ —Ç–≤–æ–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ `Ecomerce`:

   ```bash
   source /home/gsa/Code/Python/Practice/SQLALchemy/.venv/bin/activate
   pip install alembic
   ```

   –ü—Ä–æ–≤–µ—Ä—å —É—Å—Ç–∞–Ω–æ–≤–∫—É:

   ```bash
   alembic --version
   ```
2. **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:

   - SQLAlchemy (—É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ —Ç–≤–æ—ë–º –ø—Ä–æ–µ–∫—Ç–µ).
   - –î—Ä–∞–π–≤–µ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (`psycopg2-binary` –¥–ª—è PostgreSQL):
     ```bash
     pip install psycopg2-binary
     ```
3. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Alembic –≤ –ø—Ä–æ–µ–∫—Ç–µ**:
   –ü–µ—Ä–µ–π–¥–∏ –≤ –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞:

   ```bash
   cd /home/gsa/Code/Python/Practice/SQLALchemy
   ```

   –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π Alembic:

   ```bash
   alembic init alembic
   ```

   –≠—Ç–æ —Å–æ–∑–¥–∞—ë—Ç:

   - –ü–∞–ø–∫—É `alembic/` —Å —Ñ–∞–π–ª–∞–º–∏ –º–∏–≥—Ä–∞—Ü–∏–π.
   - –§–∞–π–ª `alembic.ini` –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Alembic

–ü–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:

```
/home/gsa/Code/Python/Practice/SQLALchemy/
‚îú‚îÄ‚îÄ alembic/
‚îÇ   ‚îú‚îÄ‚îÄ env.py          # –°–∫—Ä–∏–ø—Ç –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ script.py.mako  # –®–∞–±–ª–æ–Ω –¥–ª—è –Ω–æ–≤—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ versions/       # –ü–∞–ø–∫–∞ —Å —Ñ–∞–π–ª–∞–º–∏ –º–∏–≥—Ä–∞—Ü–∏–π
‚îî‚îÄ‚îÄ alembic.ini         # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª
```

- **`alembic.ini`**: –°–æ–¥–µ—Ä–∂–∏—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, —Ç–∞–∫–∏–µ –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ.
- **`env.py`**: –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫ Alembic –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å —Ç–≤–æ–∏–º–∏ –º–æ–¥–µ–ª—è–º–∏ SQLAlchemy –∏ –±–∞–∑–æ–π.
- **`versions/`**: –•—Ä–∞–Ω–∏—Ç Python-—Ñ–∞–π–ª—ã –º–∏–≥—Ä–∞—Ü–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, `abc123_add_column.py`).
- **`script.py.mako`**: –®–∞–±–ª–æ–Ω –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–æ–≤—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π.

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Alembic

#### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ `alembic.ini`

–û—Ç–∫—Ä–æ–π `alembic.ini` –∏ —É–∫–∞–∂–∏ —Å—Ç—Ä–æ–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Ç–≤–æ–µ–π –±–∞–∑–µ PostgreSQL:

```ini
[alembic]
script_location = alembic
sqlalchemy.url = postgresql+psycopg2://gsa:0502@localhost:8080/PostgreSQL
```

- **`sqlalchemy.url`**: –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç–≤–æ–µ–º—É `engine` –≤ `main.py`. –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å `sqlalchemy_course`, —É–∫–∞–∂–∏:
  ```ini
  sqlalchemy.url = postgresql+psycopg2://gsa:0502@localhost:8080/sqlalchemy_course
  ```
- –î—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
  ```ini
  file_template = %%(rev)s_%%(slug)s  # –§–æ—Ä–º–∞—Ç –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–æ–≤ –º–∏–≥—Ä–∞—Ü–∏–π
  timezone = UTC                      # –í—Ä–µ–º–µ–Ω–Ω–∞—è –∑–æ–Ω–∞ –¥–ª—è –º–µ—Ç–æ–∫ –≤—Ä–µ–º–µ–Ω–∏
  ```

#### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ `env.py`

–§–∞–π–ª `alembic/env.py` –Ω—É–∂–Ω–æ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å, —á—Ç–æ–±—ã Alembic –∑–Ω–∞–ª –æ —Ç–≤–æ–∏—Ö –º–æ–¥–µ–ª—è—Ö (`Base` –∏–∑ `models.base`). –ü—Ä–∏–º–µ—Ä:

```python
# alembic/env.py
from logging.config import fileConfig
from sqlalchemy import engine_from_config, pool
from alembic import context

# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º Base –∏ –º–æ–¥–µ–ª–∏
from models.base import Base
from models.owners import Owner
from models.pets import Pet
from models.species import Species
from models.manipulations import Manipulation
from models.manipulation_facts import ManipulationFact

config = context.config
fileConfig(config.config_file_name)

# –£–∫–∞–∑—ã–≤–∞–µ–º metadata –¥–ª—è –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–∏–≥—Ä–∞—Ü–∏–π
target_metadata = Base.metadata

def run_migrations_offline():
    url = config.get_main_option("sqlalchemy.url")
    context.configure(
        url=url,
        target_metadata=target_metadata,
        literal_binds=True,
        dialect_opts={"paramstyle": "named"},
    )
    with context.begin_transaction():
        context.run_migrations()

def run_migrations_online():
    connectable = engine_from_config(
        config.get_section(config.config_ini_section),
        prefix="sqlalchemy.",
        poolclass=pool.NullPool,
    )
    with connectable.connect() as connection:
        context.configure(
            connection=connection,
            target_metadata=target_metadata
        )
        with context.begin_transaction():
            context.run_migrations()

if context.is_offline_mode():
    run_migrations_offline()
else:
    run_migrations_online()
```

- **–ò–∑–º–µ–Ω–µ–Ω–∏—è**:
  - –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π `Base` –∏ –≤—Å–µ –º–æ–¥–µ–ª–∏ (`Owner`, `Pet`, etc.).
  - –£–∫–∞–∂–∏ `target_metadata = Base.metadata` –¥–ª—è —Å–≤—è–∑–∏ —Å —Ç–≤–æ–∏–º–∏ –º–æ–¥–µ–ª—è–º–∏.
- **–ó–∞—á–µ–º**: –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç Alembic —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å —Ç–µ–∫—É—â—É—é —Å—Ö–µ–º—É –±–∞–∑—ã —Å `Base.metadata` –¥–ª—è –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–∏–≥—Ä–∞—Ü–∏–π.

#### 3. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≤–µ—Ä—Å–∏–π

Alembic —Å–æ–∑–¥–∞—ë—Ç —Ç–∞–±–ª–∏—Ü—É `alembic_version` –≤ –±–∞–∑–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ –º–∏–≥—Ä–∞—Ü–∏–∏. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π –µ—ë:

```bash
alembic stamp head
```

–ü—Ä–æ–≤–µ—Ä—å –≤ PostgreSQL:

```bash
psql -h localhost -p 8080 -U gsa -d PostgreSQL -c "SELECT * FROM alembic_version;"
```

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã Alembic

Alembic –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç CLI-–∫–æ–º–∞–Ω–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏—è–º–∏. –í—ã–ø–æ–ª–Ω—è–π –∏—Ö –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞:

1. **`alembic init <directory>`**:

   - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç Alembic, —Å–æ–∑–¥–∞—ë—Ç –ø–∞–ø–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, `alembic`).
   - –ü—Ä–∏–º–µ—Ä: `alembic init alembic`
2. **`alembic revision -m "message"`**:

   - –°–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ `alembic/versions/` —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º –æ–ø–∏—Å–∞–Ω–∏–µ–º.
   - –ü—Ä–∏–º–µ—Ä:
     ```bash
     alembic revision -m "add age column to pets"
     ```

     –°–æ–∑–¥–∞—ë—Ç —Ñ–∞–π–ª, –Ω–∞–ø—Ä–∏–º–µ—Ä, `abc123_add_age_column_to_pets.py`.
3. **`alembic revision --autogenerate -m "message"`**:

   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –º–∏–≥—Ä–∞—Ü–∏—é, —Å—Ä–∞–≤–Ω–∏–≤–∞—è `Base.metadata` —Å —Ç–µ–∫—É—â–µ–π —Å—Ö–µ–º–æ–π –±–∞–∑—ã.
   - –ü—Ä–∏–º–µ—Ä:
     ```bash
     alembic revision --autogenerate -m "add age to pets"
     ```
   - **–í–∞–∂–Ω–æ**: –£–±–µ–¥–∏—Å—å, —á—Ç–æ –≤—Å–µ –º–æ–¥–µ–ª–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ `env.py`, –∏–Ω–∞—á–µ –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–µ —É–≤–∏–¥–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è.
4. **`alembic upgrade <revision>`**:

   - –ü—Ä–∏–º–µ–Ω—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–æ —É–∫–∞–∑–∞–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏ (–∏–ª–∏ `head` –¥–ª—è –ø–æ—Å–ª–µ–¥–Ω–µ–π).
   - –ü—Ä–∏–º–µ—Ä:
     ```bash
     alembic upgrade head
     ```

     –ü—Ä–∏–º–µ–Ω—è–µ—Ç –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏.
   - –ò–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –≤–µ—Ä—Å–∏—è:
     ```bash
     alembic upgrade abc123
     ```
5. **`alembic downgrade <revision>`**:

   - –û—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–æ —É–∫–∞–∑–∞–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏ (–∏–ª–∏ `base` –¥–ª—è –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è).
   - –ü—Ä–∏–º–µ—Ä:
     ```bash
     alembic downgrade -1
     ```

     –û—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–≥—Ä–∞—Ü–∏—é.
   - –ò–ª–∏:
     ```bash
     alembic downgrade base
     ```

     –£–¥–∞–ª—è–µ—Ç –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏.
6. **`alembic current`**:

   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ –±–∞–∑–µ.
   - –ü—Ä–∏–º–µ—Ä:
     ```bash
     alembic current
     ```

     –í—ã–≤–æ–¥: `abc123 (head)`
7. **`alembic history`**:

   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –º–∏–≥—Ä–∞—Ü–∏–π.
   - –ü—Ä–∏–º–µ—Ä:

     ```bash
     alembic history
     ```

     –í—ã–≤–æ–¥:
     ```
     abc123 -> def456 (head), add index to pets
     base -> abc123, add age column to pets
     ```
8. **`alembic stamp <revision>`**:

   - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ `alembic_version` –±–µ–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π.
   - –ü—Ä–∏–º–µ—Ä:
     ```bash
     alembic stamp head
     ```
9. **`alembic merge <revision1> <revision2>`**:

   - –û–±—ä–µ–¥–∏–Ω—è–µ—Ç –¥–≤–µ –≤–µ—Ç–∫–∏ –º–∏–≥—Ä–∞—Ü–∏–π –≤ –æ–¥–Ω—É (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞—Ö –≤ –∫–æ–º–∞–Ω–¥–µ).
   - –ü—Ä–∏–º–µ—Ä:
     ```bash
     alembic merge abc123 def456
     ```
10. **`alembic heads`**:

    - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ "–≥–æ–ª–æ–≤—ã" (head) –º–∏–≥—Ä–∞—Ü–∏–π, –µ—Å–ª–∏ –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–µ—Ç–æ–∫.
    - –ü—Ä–∏–º–µ—Ä:
      ```bash
      alembic heads
      ```

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª—å –≤–µ—Ä—Å–∏–π

- **–ú–∏–≥—Ä–∞—Ü–∏–∏ –∫–∞–∫ –≤–µ—Ä—Å–∏–∏**: –ö–∞–∂–¥–∞—è –º–∏–≥—Ä–∞—Ü–∏—è ‚Äî —ç—Ç–æ Python-—Ñ–∞–π–ª –≤ `alembic/versions/` —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, `abc123`). –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏–∏:
  - `upgrade()`: –ü—Ä–∏–º–µ–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `op.create_table`).
  - `downgrade()`: –û—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `op.drop_table`).
- **–¢–∞–±–ª–∏—Ü–∞ `alembic_version`**: –•—Ä–∞–Ω–∏—Ç —Ç–µ–∫—É—â–∏–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –º–∏–≥—Ä–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `abc123`), —á—Ç–æ–±—ã Alembic –∑–Ω–∞–ª, –∫–∞–∫–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ —É–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã.
- **–î–∞–≥ –º–∏–≥—Ä–∞—Ü–∏–π**: –ú–∏–≥—Ä–∞—Ü–∏–∏ –æ–±—Ä–∞–∑—É—é—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –∞—Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–π –≥—Ä–∞—Ñ (DAG), –≥–¥–µ –∫–∞–∂–¥–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é —á–µ—Ä–µ–∑ –∞—Ç—Ä–∏–±—É—Ç `down_revision`.
- **–í–µ—Ç–≤–ª–µ–Ω–∏–µ**: –ï—Å–ª–∏ –¥–≤–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ —Å–æ–∑–¥–∞—é—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ, –≤–æ–∑–Ω–∏–∫–∞—é—Ç –≤–µ—Ç–∫–∏. –ò—Ö –º–æ–∂–Ω–æ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å —Å `alembic merge`.

**–ü—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞ –º–∏–≥—Ä–∞—Ü–∏–∏**:

```python
# alembic/versions/abc123_add_age_column_to_pets.py
from alembic import op
import sqlalchemy as sa

revision = 'abc123'
down_revision = None
branch_labels = None
depends_on = None

def upgrade():
    op.add_column('pets', sa.Column('age', sa.Integer, nullable=True))

def downgrade():
    op.drop_column('pets', 'age')
```

- `revision`: –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –º–∏–≥—Ä–∞—Ü–∏–∏.
- `down_revision`: ID –ø—Ä–µ–¥—ã–¥—É—â–µ–π –º–∏–≥—Ä–∞—Ü–∏–∏.
- `upgrade()`: –î–æ–±–∞–≤–ª—è–µ—Ç —Å—Ç–æ–ª–±–µ—Ü `age` –≤ —Ç–∞–±–ª–∏—Ü—É `pets`.
- `downgrade()`: –£–¥–∞–ª—è–µ—Ç —Å—Ç–æ–ª–±–µ—Ü `age`.

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ `Ecomerce`

#### –®–∞–≥ 1: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

```bash
cd /home/gsa/Code/Python/Practice/SQLALchemy
alembic init alembic
```

#### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞

- –í `alembic.ini`:
  ```ini
  sqlalchemy.url = postgresql+psycopg2://gsa:0502@localhost:8080/PostgreSQL
  ```
- –í `alembic/env.py` –¥–æ–±–∞–≤—å:
  ```python
  from models.base import Base
  from models.owners import Owner
  from models.pets import Pet
  from models.species import Species
  from models.manipulations import Manipulation
  from models.manipulation_facts import ManipulationFact
  target_metadata = Base.metadata
  ```

#### –®–∞–≥ 3: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–∞—á–∞–ª—å–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏

–ï—Å–ª–∏ —Ç–≤–æ–∏ —Ç–∞–±–ª–∏—Ü—ã (`owners`, `pets`, etc.) —É–∂–µ —Å–æ–∑–¥–∞–Ω—ã —á–µ—Ä–µ–∑ `Base.metadata.create_all()`, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–π Alembic:

```bash
alembic revision --autogenerate -m "initial schema"
```

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–∞–π–ª (–Ω–∞–ø—Ä–∏–º–µ—Ä, `alembic/versions/abc123_initial_schema.py`), –µ—Å–ª–∏ –Ω—É–∂–Ω–æ. –ü—Ä–∏–º–µ—Ä:

```python
from alembic import op
import sqlalchemy as sa

revision = 'abc123'
down_revision = None

def upgrade():
    op.create_table(
        'owners',
        sa.Column('owner_id', sa.Integer, primary_key=True),
        sa.Column('owner_name', sa.String, nullable=False),
        sa.Column('owner_email', sa.String)
    )
    op.create_table(
        'pets',
        sa.Column('id', sa.Integer, primary_key=True),
        sa.Column('owner_id', sa.Integer, sa.ForeignKey('owners.owner_id')),
        sa.Column('name', sa.String, nullable=False)
    )
    # –î—Ä—É–≥–∏–µ —Ç–∞–±–ª–∏—Ü—ã...

def downgrade():
    op.drop_table('pets')
    op.drop_table('owners')
    # –î—Ä—É–≥–∏–µ —Ç–∞–±–ª–∏—Ü—ã...
```

–ü—Ä–∏–º–µ–Ω—è–π –º–∏–≥—Ä–∞—Ü–∏—é:

```bash
alembic upgrade head
```

#### –®–∞–≥ 4: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞

–î–æ–±–∞–≤—å —Å—Ç–æ–ª–±–µ—Ü `age` –≤ –º–æ–¥–µ–ª—å `Pet`:

```python
# models/pets.py
class Pet(Base):
    __tablename__ = 'pets'
    id = Column(Integer, primary_key=True)
    owner_id = Column(Integer, ForeignKey('owners.owner_id'))
    name = Column(String, nullable=False)
    age = Column(Integer, nullable=True)  # –ù–æ–≤—ã–π —Å—Ç–æ–ª–±–µ—Ü
```

–°–æ–∑–¥–∞–π –º–∏–≥—Ä–∞—Ü–∏—é:

```bash
alembic revision --autogenerate -m "add age to pets"
```

–ü—Ä–æ–≤–µ—Ä—å `alembic/versions/def456_add_age_to_pets.py`:

```python
def upgrade():
    op.add_column('pets', sa.Column('age', sa.Integer, nullable=True))

def downgrade():
    op.drop_column('pets', 'age')
```

–ü—Ä–∏–º–µ–Ω—è–π:

```bash
alembic upgrade head
```

#### –®–∞–≥ 5: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞

–¢—ã —Å–ø—Ä–∞—à–∏–≤–∞–ª –ø—Ä–æ –∏–Ω–¥–µ–∫—Å—ã. –°–æ–∑–¥–∞–π –∏–Ω–¥–µ–∫—Å –Ω–∞ `Pet.owner_id`:

```bash
alembic revision --autogenerate -m "add index on pet owner_id"
```

–†–µ–¥–∞–∫—Ç–∏—Ä—É–π –º–∏–≥—Ä–∞—Ü–∏—é:

```python
def upgrade():
    op.create_index('ix_pet_owner_id', 'pets', ['owner_id'], unique=False)

def downgrade():
    op.drop_index('ix_pet_owner_id', table_name='pets')
```

–ü—Ä–∏–º–µ–Ω—è–π:

```bash
alembic upgrade head
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å FastAPI

–í `Ecomerce` —Ç—ã –∏—Å–ø–æ–ª—å–∑—É–µ—à—å FastAPI. –î–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:

```python
# src/main.py
from sqlalchemy import create_engine
from alembic.config import Config
from alembic import command

engine = create_engine('postgresql+psycopg2://gsa:0502@localhost:8080/PostgreSQL')

def apply_migrations():
    alembic_cfg = Config("alembic.ini")
    command.upgrade(alembic_cfg, "head")

if __name__ == "__main__":
    apply_migrations()
    # –ó–∞–ø—É—Å–∫ FastAPI
```

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π –∫–æ–º–∞–Ω–¥—É –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º:

```bash
alembic upgrade head
uvicorn src.main:app --reload
```

### –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

1. **–ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å—é**:
   - –ü—Ä–æ–≤–µ—Ä—è–π —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏, —Ç–∞–∫ –∫–∞–∫ –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –º–æ–∂–µ—Ç –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Å–ª–æ–∂–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Å—Ç–æ–ª–±—Ü–æ–≤).
2. **–Ø—Å–Ω—ã–µ –æ–ø–∏—Å–∞–Ω–∏—è**:
   - –ò—Å–ø–æ–ª—å–∑—É–π –ø–æ–Ω—è—Ç–Ω—ã–µ `-m "message"` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `"add age to pets"`).
3. **–†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏**:
   - –ü–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏—è–º–∏ –¥–µ–ª–∞–π –±—ç–∫–∞–ø –±–∞–∑—ã:
     ```bash
     pg_dump -h localhost -p 8080 -U gsa PostgreSQL > backup.sql
     ```
4. **–¢–µ—Å—Ç–∏—Ä—É–π –º–∏–≥—Ä–∞—Ü–∏–∏**:
   - –°–æ–∑–¥–∞–π —Ç–µ—Å—Ç–æ–≤—É—é –±–∞–∑—É –≤ Docker:

     ```bash
     docker run -d --name test_postgres -e POSTGRES_USER=gsa -e POSTGRES_PASSWORD=0502 -e POSTGRES_DB=test_db -p 8081:5432 postgres:16.4
     ```

     –ü—Ä–∏–º–µ–Ω—è–π –º–∏–≥—Ä–∞—Ü–∏–∏:
     ```bash
     alembic -x sqlalchemy.url=postgresql+psycopg2://gsa:0502@localhost:8081/test_db upgrade head
     ```
5. **–ö–æ–Ω—Ç—Ä–æ–ª—å –≤–µ—Ä—Å–∏–π –≤ Git**:
   - –î–æ–±–∞–≤—å `alembic/versions/` –∏ `alembic.ini` –≤ Git:
     ```bash
     git add alembic/
     git commit -m "Add Alembic migrations"
     ```
6. **–ò–∑–±–µ–≥–∞–π —Ä—É—á–Ω–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±–∞–∑—ã**:
   - –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–Ω–æ—Å–∏—Ç–µ —á–µ—Ä–µ–∑ –º–∏–≥—Ä–∞—Ü–∏–∏, –∞ –Ω–µ —á–µ—Ä–µ–∑ `psql`.

### –°–≤—è–∑—å —Å —Ç–≤–æ–∏–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º

- **–ü—Ä–æ–µ–∫—Ç `Ecomerce`**: –¢—ã –∏—Å–ø–æ–ª—å–∑—É–µ—à—å SQLAlchemy —Å PostgreSQL, `sessionmaker`, JOIN-—ã, `relationship`, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –∏–Ω–¥–µ–∫—Å—ã –∏ –∫—ç—à. Alembic –ø–æ–º–æ–∂–µ—Ç:
  - –£–ø—Ä–∞–≤–ª—è—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ —Ç–∞–±–ª–∏—Ü (`Owners`, `Pets`, etc.).
  - –î–æ–±–∞–≤–ª—è—Ç—å –∏–Ω–¥–µ–∫—Å—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞ `Pets.owner_id`).
  - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—Ö–µ–º—É —Å –º–æ–¥–µ–ª—è–º–∏, –æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö —Å—Ç–æ–ª–±—Ü–æ–≤ –∏–ª–∏ —Ç–∞–±–ª–∏—Ü.
- **–ü—Ä–∏–º–µ—Ä**: –ï—Å–ª–∏ —Ç—ã –¥–æ–±–∞–≤–∏—à—å `relationship` –≤ `Pet` –¥–ª—è —Å–≤—è–∑–∏ —Å `Species`, Alembic —Å–æ–∑–¥–∞—Å—Ç –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è –Ω–æ–≤–æ–≥–æ `ForeignKey`.
- **Docker**: –£–±–µ–¥–∏—Å—å, —á—Ç–æ PostgreSQL –¥–æ—Å—Ç—É–ø–µ–Ω:
  ```bash
  docker ps | grep PostgreSQL
  psql -h localhost -p 8080 -U gsa -d PostgreSQL
  ```

### –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

1. **–û—à–∏–±–∫–∞ "Table not found"**:
   - –£–±–µ–¥–∏—Å—å, —á—Ç–æ –≤—Å–µ –º–æ–¥–µ–ª–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ `env.py`.
   - –ü—Ä–æ–≤–µ—Ä—å —Å—Ç—Ä–æ–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤ `alembic.ini`.
2. **–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –º–∏–≥—Ä–∞—Ü–∏–π**:
   - –ï—Å–ª–∏ –¥–≤–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ —Å–æ–∑–¥–∞–ª–∏ –º–∏–≥—Ä–∞—Ü–∏–∏, –∏—Å–ø–æ–ª—å–∑—É–π:
     ```bash
     alembic merge abc123 def456 -m "merge branches"
     ```
3. **–ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–µ –≤–∏–¥–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π**:
   - –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ `Base.metadata` –≤–∫–ª—é—á–∞–µ—Ç –≤—Å–µ –º–æ–¥–µ–ª–∏.
   - –£–±–µ–¥–∏—Å—å, —á—Ç–æ –±–∞–∑–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–∞:
     ```bash
     alembic current
     ```
4. **–û—à–∏–±–∫–∏ PostgreSQL**:
   - –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏:
     ```bash
     docker logs PostgreSQL
     ```
   - –£–±–µ–¥–∏—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å `gsa` –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞:
     ```sql
     GRANT ALL PRIVILEGES ON DATABASE PostgreSQL TO gsa;
     ```

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

1. **–ö–∞—Å—Ç–æ–º–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**:
   - –ò—Å–ø–æ–ª—å–∑—É–π `op.execute()` –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã—Ö SQL:
     ```python
     def upgrade():
         op.execute("CREATE INDEX custom_idx ON pets USING GIN (name)")
     ```
2. **–ú–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö**:
   - –î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ —Ç–∞–±–ª–∏—Ü–µ:
     ```python
     def upgrade():
         op.execute("UPDATE pets SET age = 0 WHERE age IS NULL")
     ```
3. **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –±–∞–∑—ã**:
   - –î–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –±–∞–∑ –∏—Å–ø–æ–ª—å–∑—É–π `-x`:
     ```bash
     alembic -x sqlalchemy.url=postgresql+psycopg2://gsa:0502@localhost:8080/other_db upgrade head
     ```
4. **CI/CD –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**:
   - –î–æ–±–∞–≤—å –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ GitHub Actions:
     ```yaml
     jobs:
       migrate:
         runs-on: ubuntu-latest
         steps:
         - uses: actions/checkout@v4
         - run: pip install alembic psycopg2-binary
         - run: alembic upgrade head
           env:
             SQLALCHEMY_URL: postgresql+psycopg2://gsa:0502@localhost:8080/PostgreSQL
     ```

### –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

- **–û—à–∏–±–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏**:
  - –ü–æ–∫–∞–∂–∏ –≤—ã–≤–æ–¥ –∫–æ–º–∞–Ω–¥—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, `alembic upgrade head`).
  - –ü—Ä–æ–≤–µ—Ä—å `alembic_version`:
    ```sql
    SELECT * FROM alembic_version;
    ```
- **–ö–æ–Ω—Ñ–ª–∏–∫—Ç –∏–º–ø–æ—Ä—Ç–æ–≤**:
  - –£–±–µ–¥–∏—Å—å, —á—Ç–æ `env.py` –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –≤—Å–µ –º–æ–¥–µ–ª–∏ –±–µ–∑ —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.
- **Docker –ø—Ä–æ–±–ª–µ–º—ã**:
  - –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç:
    ```bash
    docker ps
    ```
  - –õ–æ–≥–∏:
    ```bash
    docker logs PostgreSQL
    ```

### –ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ

1. –£—Å—Ç–∞–Ω–æ–≤–∏ –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π:
   ```bash
   pip install alembic
   alembic init alembic
   ```
2. –ù–∞—Å—Ç—Ä–æ–π `alembic.ini`:
   ```ini
   sqlalchemy.url = postgresql+psycopg2://gsa:0502@localhost:8080/PostgreSQL
   ```
3. –ù–∞—Å—Ç—Ä–æ–π `env.py`:
   ```python
   from models.base import Base
   target_metadata = Base.metadata
   ```
4. –°–æ–∑–¥–∞–π –Ω–∞—á–∞–ª—å–Ω—É—é –º–∏–≥—Ä–∞—Ü–∏—é:
   ```bash
   alembic revision --autogenerate -m "initial schema"
   alembic upgrade head
   ```
5. –ü—Ä–æ–≤–µ—Ä—å:
   ```bash
   psql -h localhost -p 8080 -U gsa -d PostgreSQL -c "\dt"
   ```

–£–¥–∞—á–∏ —Å Alembic –≤ —Ç–≤–æ—ë–º –ø—Ä–æ–µ–∫—Ç–µ `Ecomerce`! üòé
